// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id         String       @id @default(cuid())
  email      String       @unique
  name       String?
  password   String?      // For future auth implementation
  settings   UserSettings?
  tasks      Task[]
  taskStages TaskStage[]
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
}

model UserSettings {
  id                   String  @id @default(cuid())
  userId               String  @unique
  // API Keys - stored encrypted
  mondayApiKey         String?
  redmineApiKey        String?
  redmineUrl           String?
  googleClientId       String?
  googleClientSecret   String?
  spotifyClientId      String?
  spotifyClientSecret  String?
  // Preferences
  theme                String  @default("dark")
  compactMode          Boolean @default(false)
  animationsEnabled    Boolean @default(true)
  // Relations
  user                 User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model Task {
  id                    String    @id @default(cuid())
  userId                String
  title                 String
  description           String?
  priority              String    // low, medium, high
  status                String    // references TaskStage.id
  order                 Int       @default(0) // Position within the column
  assignee              String?
  dueDate               DateTime?
  tags                  String?   // JSON string for SQLite compatibility
  project               String?
  linkedProjectId       String?   // Link to Monday.com project
  linkedMessageThreadId String?   // Link to Redmine thread
  // Relations
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@index([status])
  @@index([priority])
}

model TaskStage {
  id        String   @id @default(cuid())
  userId    String
  title     String
  order     Int      @default(0) // Position of the column
  color     String?  // Optional color for the column
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([order])
}
